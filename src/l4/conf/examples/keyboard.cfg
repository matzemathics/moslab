-- vi:ft=lua

local L4 = require("L4");

local ld = L4.default_loader;
local kb_vbus = ld:new_channel();
local fb_vbus = ld:new_channel();
local fbdrv = ld:new_channel();

ld:start(
    { caps = { gui = kb_vbus:svr(),
               fbdrv = fb_vbus:svr(),
               icu = L4.Env.icu,
               sigma0 = L4.cast(L4.Proto.Factory, L4.Env.sigma0):create(L4.Proto.Sigma0) },
      log = { "IO", "yellow" } },
    "rom/io -vvvv rom/x86-legacy.devs rom/x86-fb.io"
);

ld:start(
    { caps = { vbus = fb_vbus , fb = fbdrv:svr() } ,
      log = { "fbdrv", "red" } },
     "rom/fb-drv -m 0x117"
);

ld:start(
    { caps = { vbus = kb_vbus, jdb = L4.Env.jdb, icu = L4.Env.icu },
      log = { "KB", "blue" } },
    "rom/keyboard"
);

ld:start(
    { caps = { vesa = fbdrv },
      log = { "PONG", "green" } },
    "rom/pong-server"
);

