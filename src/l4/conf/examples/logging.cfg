-- vim:set ft=lua

local L4 = require("L4");

local ld = L4.default_loader;
local logging = ld:new_channel();
local vbus = ld:new_channel();
local fbdrv = ld:new_channel();

ld:start(
    { caps = { fbdrv = vbus:svr(),
               icu = L4.Env.icu,
               sigma0 = L4.cast(L4.Proto.Factory, L4.Env.sigma0):create(L4.Proto.Sigma0) },
      log = { "IO", "yellow" } },
    "rom/io rom/x86-legacy.devs rom/x86-fb.io"
);

local fb_task = ld:start(
    { caps = { vbus = vbus , fb = fbdrv:svr() } ,
      log = { "fbdrv", "red" } },
    "rom/fb-drv -m 0x117"
);

ld:start(
	{ caps = { logging_server = logging:svr(), fb = fbdrv },
      log = { "server", "blue" } },
    "rom/server"
);

ld:start(
    { caps = { logging_server = logging:create(0, "clnt 0") },
      log = { "client", "red" } },
    "rom/client"
);

ld:start(
    { caps = { logging_server = logging:create(0, "clnt 1") },
      log = { "client", "green" } },
    "rom/client"
);
