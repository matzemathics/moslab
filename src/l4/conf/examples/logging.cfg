-- vim:set ft=lua

local L4 = require("L4");

local ld = L4.default_loader;
local channel = ld:new_channel();

print("starting server...");

local task = ld:start(
	{ caps = { logging_server = channel:svr(); },
      log = { "server", "blue" } },
    "rom/server"
);

task:exit_handler(function(exit_code)
  if exit_code == nil then
    print("Task was killed")
  else
    print("Task has terminated w/ code [" .. exit_code .. "]")
  end
end)


print("starting client...");

ld:start(
    { caps = { logging_server = channel:create(0, "clnt") },
      log = { "client", "red" } },
    "rom/client"
);

print("server and client running.");

